<link rel="preconnect" href="https://s4.zstatic.net" />
<script src="https://s4.zstatic.net/ajax/libs/vue/3.3.7/vue.global.prod.min.js"></script>
<link
  rel="stylesheet"
  href="https://s4.zstatic.net/ajax/libs/font-awesome/6.4.2/css/all.min.css"
/>
<link rel="preconnect" href="https://fonts.googleapis.cn" />
<link rel="preconnect" href="https://fonts.gstatic.cn" crossorigin />
<link
  rel="stylesheet"
  href="https://fonts.googleapis.cn/css2?family=Fira+Code:wght@400;500;600;700&family=Lexend:wght@400;500;600;700;800;900&family=Noto+Sans+SC:wght@400;500;600;700;800;900&display=swap"
/>
<script>
  const mixins = {};
</script>
<script src="<%- url_for('/js/jquery-3.7.1.js') %>"></script>
<% if (theme.polyfill.enable) { %>
<script src="https://polyfill.alicdn.com/v3/polyfill.min.js?features=<%- theme.polyfill.features %>"></script>
<% } %>

<!-- PrismJS -->
<% if (theme.prismjs.enable) { %>
<!-- PrismJS 样式 -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism-tomorrow.min.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs/plugins/line-numbers/prism-line-numbers.min.css" />

<!-- PrismJS 高亮脚本 -->
<script>
(function () {
  const prismCoreURL = "https://cdn.jsdelivr.net/npm/prismjs@1.29.0";
  const componentURL = prismCoreURL + "/components/";
  const pluginURL = prismCoreURL + "/plugins/";

  const langMap = {
    c: "c", cpp: "cpp", java: "java", python: "python",
    js: "javascript", javascript: "javascript", json: "json",
    html: "markup", xml: "markup", bash: "bash", shell: "bash",
    sh: "bash", md: "markdown", markdown: "markdown",
    yaml: "yaml", yml: "yaml", go: "go", php: "php", css: "css"
  };

  const loadScript = (src) => new Promise((resolve, reject) => {
    const s = document.createElement("script");
    s.src = src;
    s.defer = true;
    s.onload = resolve;
    s.onerror = reject;
    document.body.appendChild(s);
  });

  const detectLangs = () => {
    const langs = new Set();
    document.querySelectorAll("code[class*='language-']").forEach((code) => {
      const match = code.className.match(/language-([\w-]+)/);
      if (match) {
        const raw = match[1].toLowerCase();
        const mapped = langMap[raw] || raw;
        if (mapped !== "none") langs.add(mapped);
      }
    });
    return [...langs];
  };

  const loadPrismAndLanguages = async () => {
    await loadScript(`${prismCoreURL}/prism.min.js`);
    await loadScript(`${pluginURL}line-numbers/prism-line-numbers.min.js`);
    const langs = detectLangs();
    await Promise.all(
      langs.map((lang) =>
        loadScript(`${componentURL}prism-${lang}.min.js`).catch(() => {
          console.warn(`Language '${lang}' not found`);
        })
      )
    );
    if (window.Prism) {
      Prism.highlightAll();
    }
  };

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", loadPrismAndLanguages);
  } else {
    loadPrismAndLanguages();
  }
})();
</script>
<% } %>


<% if (theme.math.enable) { %>
<script src="https://s4.zstatic.net/ajax/libs/KaTeX/0.16.9/katex.min.js"></script>
<script src="https://s4.zstatic.net/ajax/libs/KaTeX/0.16.9/contrib/auto-render.min.js"></script>
<link
  rel="stylesheet"
  href="https://s4.zstatic.net/ajax/libs/KaTeX/0.16.9/katex.min.css"
/>
<script src="<%- url_for('/js/lib/math.js') %>"></script>
<% } %> <% if (theme.preview.enable) { %>
<!-- <script src="<%- url_for('/js/preview.js') %>"></script> -->
<% } %> <% if (theme.crypto.enable && typeof page.secret !== "undefined") { %>
<script src="https://s4.zstatic.net/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
<script src="<%- url_for('/js/lib/crypto.js') %>"></script>
<% } %> <% if (type === "archives" && theme.search.enable) { %>
<script src="<%- url_for('/js/lib/search.js') %>"></script>
<% } %> <% if (type === "post" && page.comments) { %> <% if
(theme.gitalk.enable) { %>
<script src="https://s4.zstatic.net/ajax/libs/gitalk/1.8.0/gitalk.min.js"></script>
<link
  rel="stylesheet"
  href="https://s4.zstatic.net/ajax/libs/gitalk/1.8.0/gitalk.min.css"
/>
<% } %> <% if (theme.waline.enable) { %>
<script src="https://s4.zstatic.net/ajax/libs/waline/2.15.8/waline.min.js"></script>
<link
  rel="stylesheet"
  href="https://s4.zstatic.net/ajax/libs/waline/2.15.8/waline.min.css"
/>
<link
  rel="stylesheet"
  href="https://s4.zstatic.net/ajax/libs/waline/2.15.8/waline-meta.min.css"
/>
<% } %> <% if (theme.twikoo.enable) { %>
<script src="https://s4.zstatic.net/ajax/libs/twikoo/1.6.31/twikoo.all.min.js"></script>
<% } %> <% } %> <% if (type === "index") { %>
<script src="<%- url_for('/js/lib/home.js') %>"></script>
<% } %> <link rel="stylesheet" href="<%- url_for("/css/main.css") %>" />
